function AddLineItem(n){var t,i;t=$("#QtdeProdutos").val();(n==t||n=="New")&&($("<div id='detailItem"+t+"' class='form-row'>").insertBefore("#itens"),html=`<div class="form-row" id=${t} style="margin-bottom:-28px;">
                        <input id="ProductId_${t}" name="product[${t}].ProductId" type="hidden" data-id="${t}" />
                        <input id="WarehouseId_${t}" name="product[${t}].WarehouseId" type="hidden" data-id="${t}" />
                        <input id="ProductNumber_${t}" name="product[${t}].ProductNumber" type="hidden" data-id="${t}" />
                        <input id="StandartCost_${t}" name="product[${t}].StandartCost" type="hidden" data-id="${t}" />
                        <input id="TaxOperationId_${t}" name="product[${t}].TaxOperationId" type="hidden" data-id="${t}" />

                        <div class="form-group col-md-4">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">${parseInt(t)+1}</span >
                                    <a href="javascript:void(0)" onclick="ExcluirLinha(${t})" class="input-group-text text-danger"  data-code="@seq"  data-tooltip="Remover produto"><i class="far fa-trash-alt"></i></a>
                                </div>
                                <input id="Name_${t}" name="product[${t}].Name" data-id="${t}" 
                                        data-url="/Invoice/GetProduct/"   class="form-control nameProduct${t}"
                                        autocomplete="on" value="" />
                            </div>
                        </div>

                        
                        <div class="form-group col-md-1">
                            <input id="Qty_${t}" data-id="${t}" name="product[${t}].Qty" class="form-control totalprice" data-thousands="." data-decimal="," data-precision="0" data-allow-zero="true" value="1"  />
                        </div>

                        <div class="form-group col-md-1">
                            <input  id="UnitPrice_${t}" data-id="${t}" name="product[${t}].UnitPrice" class="form-control totalprice" data-thousands="." data-decimal="," data-precision="2" data-allow-zero="true" value="0"  />
                        </div>

                        <div class="form-group col-md-1">
                            <input   id="TaxProduction_${t}" data-id="${t}" name="product[${t}].TaxProduction" class="form-control totalprice" data-thousands="." data-decimal="," data-precision="2" data-allow-zero="true" value="0" />
                        </div>

                        <div class="form-group col-md-1">

                            <input id="TaxSales_${t}" data-id="${t}" name="product[${t}].TaxSales" class="form-control totalprice" data-thousands="." data-decimal="," data-precision="2"  data-allow-zero="true" value="0"/>
                        </div>

                        <div class="form-group col-md-1">
                            <input  id="CodOper_${t}" data-id="${t}" name="product[${t}].CodOper" class="form-control" data-thousands="" data-decimal="" data-precision="0" data-allow-zero="true" value="0"  />
                        </div>
                        <div class="form-group col-md-1">
                            <input   id="Discont_${t}" data-id="${t}" name="product[${t}].Discont" class="form-control totalprice" data-thousands="." data-decimal="," data-precision="2" data-allow-zero="true" value="0" />
                        </div>

                        <div class="form-group col-md-2">
                                <input  id="Total_${t}" data-id="${t}" name="product[${t}].Total" disabled="disabled" class="form-control subtotalitem" data-thousands="." data-decimal="," data-precision="2" data-allow-zero="true" value="0" />
                        </div>
             </div>`,i=document.getElementById("listproduct"),$(html).appendTo("#listproduct"),iniciarAutoCompleteProduto(t),iniciarForm(t),$("#Name_"+t).focus(),t++,$("#QtdeProdutos").val(t))}function ExcluirLinha(n){if(confirm("Você confirma a exclusão deste item na nota fiscal?")){let t=1;n!="Limpar"&&(t=n,$("#"+t).fadeOut(300,function(){$(this).css("display","none")}));$("#ProductId_"+t).val("0")}}function iniciarAutoCompleteProduto(n){var t=$("#Name_"+n),i=$('input[name = "__RequestVerificationToken"').val();$("#Name_"+n).autocomplete({source:function(t,r){$.ajax({url:"/Invoice/GetProduct/",type:"POST",dataType:"json",data:{name:t.term,TaxOperationID:taxId,id:n,locationId:locationId},headers:{RequestVerificationToken:i},success:function(n){r($.map(n,function(n){return{label:n.name,value:n.productId,id:n.id,seq:n.seq,qty:n.qty,unitprice:n.unitPrice,taxproduction:n.taxProduction,taxsales:n.taxSales,discont:n.discont,codoper:n.codOper,total:n.total,warehouseId:n.warehouseId,productNumber:n.productNumber,standartCost:n.standartCost,taxOperationId:n.taxOperationId}}))}})},select:function(i,r){setValuesOnElement(t,i,r,n)},change:function(i,r){setValuesOnElement(t,i,r,n)},messages:{noResults:"",results:function(){}}})}function iniciarForm(){$("[data-decimal]").each(function(){var n=$(this);n.maskMoney()});$(".totalprice").each(function(){var n=$(this);n.on("blur",function(){var i=$(this),n=i.attr("data-id"),t=DesFormataMoeda($("#UnitPrice_"+n).val())||0,r=$("#Qty_"+n).val()||1,u=(DesFormataMoeda($("#Discont_"+n).val())||0)/100,t=t*(1-u),f=t*r;$("#Total_"+n).val(f);atualizaSubTotal()})})}function atualizaSubTotal(){var n=0;$(".subtotalitem").each(function(){var t=$(this),i=parseFloat(t.val());n+=i});$("#SubTotal").val(n)}function setValuesOnElement(n,t,i,r){i.item?($("#ProductId_"+r).val(i.item.value),$("#Qty_"+r).val(i.item.qty),$("#UnitPrice_"+r).val(i.item.unitprice),$("#TaxProduction_"+r).val(i.item.taxproduction),$("#TaxSales_"+r).val(i.item.taxsales),$("#Discont_"+r).val(i.item.discont),$("#CodOper_"+r).val(i.item.codoper),$("#Total_"+r).val(i.item.total),$("#WarehouseId_"+r).val(i.item.warehouseId),$("#ProductNumber_"+r).val(i.item.productNumber),$("#StandartCost_"+r).val(i.item.standartCost),$("#TaxOperationId_"+r).val(i.item.taxOperationId),n.val(i.item.label)):($("#productid_"+r).val(""),$("#ProductId_"+r).val(""),$("#Qty_"+r).val(""),$("#UnitPrice_"+r).val(""),$("#TaxProduction_"+r).val(""),$("#TaxSales_"+r).val(""),$("#Discont_"+r).val(""),$("#codoper_"+r).val(""),$("#Total_"+r).val(""),$("#WarehouseId_"+r).val(""),$("#ProductNumber_"+r).val(""),$("#StandartCost_"+r).val(""),$("#TaxOperationId_"+r).val(""),n.val(""))}var taxId=$("#TaxOperationId option:selected").val(),locationId=$("#WarehouseId option:selected").val();$("#CustomerName").autocomplete({source:function(n,t){$.ajax({url:$("#CustomerName").attr("data-url"),type:"POST",dataType:"json",data:{name:n.term},headers:{RequestVerificationToken:$("#CustomerName").attr("data-token")},success:function(n){t($.map(n,function(n){return{label:n.customerId+", "+n.firstName+(n.lastName?", "+n.lastName:""),value:n.customerId}}))}})},select:function(n,t){$("#CustomerId").val(t.item?t.item.value:"");$("#CustomerName").val(t.item?t.item.label:"")},change:function(n,t){$("#CustomerId").val(t.item?t.item.value:"");$("#CustomerName").val(t.item?t.item.label:"")},messages:{noResults:"",results:function(){}}});$(document).ready(function(){var n=$("#QtdeProdutos").val();n==0&&AddLineItem("New");$(".alert-dismissible").fadeTo(2e3,500).slideUp(500,function(){$(".alert-dismissible").alert("close")});iniciarForm(0)});